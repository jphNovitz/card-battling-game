<!-- Try to make a  card battling game -->
<!-- using vanilla javascript          -->
<!-- @jphNovitz                        -->
<!-- hello@jiphi.be                    -->

<html>
    <head>
        <meta charset="UTF-8"> 
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
            rel="stylesheet" 
            integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
            crossorigin="anonymous">
        <title>card battling game @jphNovitz</title>
    </head>

    <body>
        <div class="container">
            <div class="row">
                    <div class="col-md-6">
                            <div id="player_1" class="col-md-12" style="border-bottom: dotted 1px #fff">
                            </div>
                            
                            <div id="player_2" class="col-md-12">
                            </div>

                            </div>
                <div class="col-md-6">
                    <div class="row">
                            <div class="lateral col-md-12">
                                <span id="points_1">
                                    0
                                </span>
                            </div>
                            <div class="col-md-12">
                                    <button id="test" class="btn btn-info btn-block">play</button>
                            </div>
                            <div class="lateral col-md-12">
                                    <span id="points_2">
                                            0
                                        </span>
                            </div>
                    </div>
                </div>

            </div>

        </div>

    </body>
    <script>
    /* variables definitions */
    const game = {
        cards : [],
        family : ['clubs',  'spades', 'hearts', 'diamonds'],
        figures : ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'Q', 'V', 'K', 'A'],
        player_1 : {
            cards: [],
            points: 0,
            encore: true
        },
        player_2 : {
            cards: [],
            points: 0,
            encore: true
        },

        initialize : function() {
            this.figures.map(fig => {
                for (let i = 0 ; i < 4 ; i++) {
                    let tempCard = {
                        'family': this.family[i],
                        'figure': fig,
                        'value': this.figures.indexOf(fig)
                    }
                    this.cards.push(tempCard)
                }
            }
            )},

        /**
        *   giveCardToPLayer() take a card from cards and give it to player
        **/
        giveCardToPlayer : function(player) {
            let randomCard = this.cards[Math.floor(Math.random() * this.cards.length)]
            let cardPosition = this.cards.indexOf(randomCard)
            player.cards.push(randomCard)
            this.cards.splice(cardPosition,1)
        },
    
        /**
        *   distribute() give alternatively cards to player 1 an player 2 
        *   till cards array is empty
        **/
        distribute : function () {
            while (this.cards.length > 0) {
                this.giveCardToPlayer(this.player_1)  // card to player 1 
                this.giveCardToPlayer(this.player_2)  // card to player 2 
            }   
        },
                

        pickCard :  function(player) {
            let card = player.cards[0]
            player.cards.splice(0,1)
            return card
        },

        displayCard : function (card, player) {
            const visualCard = document.createElement('div')
            visualCard.classList.add('card')
            const cardContent = document.createTextNode(card.figure)
            visualCard.appendChild(cardContent)
            document.getElementById(player).appendChild(visualCard)
            return visualCard
        },

        givePoints: function () {}

}

function play (obj){
   
    if (obj.player_1.encore) {
        console.log(obj.player_1.cards.length)
        const card = obj.pickCard(obj.player_1)
        const visualCard = (obj.displayCard)(card, 'player_1')
        
        document.getElementById('player_1').appendChild(visualCard)
        obj.player_1.points += card.value
        document.getElementById('points_1').innerHTML= obj.player_1.points
            
        if (obj.player_1.cards.length === 1) {
            obj.player_1.encore = false
        }
    }
        window.setTimeout(function () {
        if (obj.player_2.encore) {
            console.log(obj.player_2.cards.length)
            const card = obj.pickCard(obj.player_2)
            const visualCard = (obj.displayCard)(card, 'player_2')
            //document.getElementById('player_2').appendChild(visualCard)
            obj.player_2.points += card.value
            document.getElementById('points_2').innerHTML= obj.player_2.points
                
            if (obj.player_2.cards.length === 1) {
            obj.player_2.encore = false
            document.getElementById('test').removeEventListener("click", alert('fini'))                        
            } 
        }
    }, 1800)
    
}
        
        const enjoy = Object.create(game);
        enjoy.initialize();       
        enjoy.distribute();
        console.log(enjoy.player_1.cards)
        console.log(enjoy.player_2.cards)
        document.getElementById('test').addEventListener('click', function () {play(enjoy)})

        
        
    </script>
</html>

<style>
    .container {
        background-color: rgb(1,130,118);
        height: 99vh;
    }

    #player_1, #player_2 {
        height: 49vh;
        min-height: 49vh;
        padding: 1.5em;
    }

    .lateral {
        height: 47vh;
        min-height: 45vh;

        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #points_1, #points_2 {
        margin: auto;
        background-color: inherit;
        color: rgb(248,236,73);
        font-size: 2em;
    }

    .card {
        background-color: #fff;
        color: #000;
        border: solid 1px rgb(248,236,73) ;
        border-radius: 5px ;  
        margin-left: -15px ; 
        margin-top: 2px;
        width: 50px ; height: 70px ; 
        float: left ; 
    }
    
</style>